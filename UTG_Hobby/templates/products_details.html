{% extends "base.html" %}
{% load static %}
{% block title %}Product Details{% endblock %}


{% block content %}
  <!-- breadcrumb start-->
  <section class="breadcrumb breadcrumb_bg">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-lg-8">
          <div class="breadcrumb_iner">
            <div class="breadcrumb_iner_item">
              <h2 class='text-warning'>Product Details </h2>
              <p class='text-white'>Home <span>-</span> Product Details</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- breadcrumb start-->
  <!--================End Home Banner Area =================-->

<!--================Single Product Area =================-->

<div class="product_image_area section_padding">
  <div class="container product_data">
      <div class="row s_product_inner justify-content-around">
        <div class="col-lg-5 col-xl-5">
          <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
              <ol class="carousel-indicators">
                  {% for img in product.images.all %}
                      <li data-target="#carouselExampleIndicators" data-slide-to="{{ forloop.counter0 }}" {% if forloop.first %}class="active"{% endif %}></li>
                  {% endfor %}
              </ol>
              <div class="carousel-inner main-image">
                {% for img in product.images.all %}
                    <div class="carousel-item {% if forloop.first %}active{% endif %}">
                        <img class="d-block w-100 zoom-image" src="{{ img.image.url }}" alt="Slide {{ forloop.counter }}">
                    </div>
                {% endfor %}
            </div>
              
          </div>
      </div>

          <div class="col-lg-5 col-xl-5">
              <div class="s_product_text">
                  <h3>{{ product.product.products_name }}</h3>
                  {% if product.product_offer < product.category_offer %}
                  <h2><span style='font-size:20px;'>&#8377;</span>{{ product.discounted_price }}</h2>
                  <h4>
                    <span style='font-size:20px;'>&#8377;</span>
                    <s>{{ product.price }}</s>
                  </h4> 
                  {% comment %} <ul class="list"> {% endcomment %}
                    <ul>
                      <a href="#" class="text-uppercase text-danger">
                          <span>Offer</span> : {{ product.category_offer|floatformat:0 }}%
                      </a>
                    </ul>
                  {% else %}
                  <h2><span style='font-size:20px;'>&#8377;</span>{{ product.discounted_price }}</h2>
                  <h2  class="text-black"><span style='font-size:20px;'>&#8377;</span><strike>{{ product.price }}</strike></h2>
                  
                  <ul>
                    <a href="#" class="text-uppercase text-danger">
                        <span>Offer</span> : {{ product.product_offer|floatformat:0 }}%
                    </a>
                  </ul>
                {% comment %} </ul> {% endcomment %}
                {% endif %}
                  <ul class="list">
                      <li>
                          <a href="#">
                              <span>Category</span> : {{ product.product.category_id.name }}
                          </a>
                      </li>
                      <li>
                          <a href="#">
                              <span>Brand</span> : {{ product.product.brand_id.name }}
                          </a>
                          <input type="hidden" id="ItemId" value="{{product.id}}"></input>
                      </li>
                      <li>
                        {% if product.quantity > 0 %}
                          <a>
                              <span>Availability</span> : <span class="text-success">In Stock</span>
                          </a>
                          {% else %}
                          <a>
                            <span>Availability</span> : <span class="text-danger">Out of Stock</span>
                        </a>
                        {% endif %}


                      </li>
                      <li>
                          <h6 class="mt-3 mb-3">Colors:</h6>
                          <div class="d-flex f-row mt-3">
                              
                              <div class="color-images">
                                  {% for v in product.product.colorvarient_set.all %}
                                      <a href="../../products_details/{{v.id}}"  data-color-variant-id="{{ v.id }}"><img src="{{v.images.last.image.url}}" alt="{{v.color}}" class="color-thumbnail border-2 " height='70px'></a>
                                  {% endfor %}
                              </div>
                          </div>
                      </li>
                  </ul>
                  <form method="POST">
                  {% csrf_token %}
                  <input type="hidden" id="product-id" value="{{product.id}}" class="prod_id">
                    <div class="card_area d-flex justify-content-between align-items-center">
                        {% if product.quantity > 0 %}
                        {% comment %} <button type="button" class="btn_3 button border-0 addcartBtn" id="" disabled>Add to Cart</button>
                        {% else %} {% endcomment %}
                        <button type="button" id="addcart" class="btn_3 button border-0">Add to Cart</button>
                        {% endif %}
                        <a href="#" class="like_us"> <i class="ti-heart"></i> </a>
                    </div>
                  </form>
              </div>
          </div>
      </div>
  </div>
</div>
<!--================End Single Product Area =================-->




  <!--================Product Description Area =================-->
  <section class="product_description_area">
    <div class="container">
        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item">
                <a class="nav-link" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home"
                   aria-selected="true">Description</a>
            </li>
            <li class="nav-item">
                <a class="nav-link active" id="review-tab" data-toggle="tab" href="#review" role="tab" aria-controls="review"
                   aria-selected="false">Reviews</a>
            </li>
        </ul>
        <div class="tab-content" id="myTabContent">
            <div class="tab-pane fade" id="home" role="tabpanel" aria-labelledby="home-tab">
                <p>
                  {{ product.product.description }}
                </p>
            </div>
            <div class="tab-pane fade show active" id="review" role="tabpanel" aria-labelledby="review-tab">
                <div class="row justify-content-between"> <!-- Added justify-content-between class -->
                    <div class="col-lg-6">
                        <div class="row total_rate">
                            <div class="col-6">
                                <div class="box_total">
                                    <h5>Overall</h5>
                                    <h4>4.0</h4>
                                    <h6>(03 Reviews)</h6>
                                </div>
                            </div>
                            <div class="review_list">
                                <div class="review_item">
                                  <div class="media-body">
                                  {% for rev in review_rating %}
                                  <div class="d-flex">
                                    <img class="rounded-circle mt-1" src="https://media.discordapp.net/attachments/991705054828560496/1200039319663026196/a2117e75dc55c149c2c68cbadee1f16e.jpg?ex=65c4bab5&is=65b245b5&hm=4eebd274a479944263804632041dfeeb8082762a3d871b8be4d2d4c7eb11a684&=&format=webp&width=711&height=701" alt="" style="width:40px;" />
                                    <h4 class="text-uppercase mt-3 ml-2">{{rev.user}}</h4>
                                  </div>
                                    {% if rev.rating > 0 %}
                                    <i class="fa fa-star {% if rev.rating < 1 %} no-checked {% else %} checked {% endif %}" id="check-star"></i>
                                    <i class="fa fa-star {% if rev.rating < 2 %} no-checked {% else %} checked {% endif %}" id="check-star"></i>
                                    <i class="fa fa-star {% if rev.rating < 3 %} no-checked {% else %} checked {% endif %}" id="check-star"></i>
                                    <i class="fa fa-star {% if rev.rating < 4 %} no-checked {% else %} checked {% endif %}" id="check-star"></i>
                                    <i class="fa fa-star {% if rev.rating < 5 %} no-checked {% else %} checked {% endif %}" id="check-star"></i>
                                    {% endif %}
                                  </div>
                                <p class="text-black mr-3">
                                  {{rev.review}}
                                </p>
                                {% endfor %}
                              </div>
                            </div>
                          </div>
                    </div>

                    <div class="col-lg-12">
                        <div class="d-flex flex-column align-items-start review_box mb-5">
                            <h4 class="ml-3">Add a Review</h4>
                            <form id="yourFormId" onsubmit="return submitForm();" method="">
                              {% csrf_token %}
                                <div class="rating ml-3">
                                <input type="radio" id="star5" name="rating" value="5" />
                                <label for="star5"></label>
                                <input type="radio" id="star4" name="rating" value="4" />
                                <label for="star4"></label>
                                <input type="radio" id="star3" name="rating" value="3" />
                                <label for="star3"></label>
                                <input type="radio" id="star2" name="rating" value="2" />
                                <label for="star2"></label>
                                <input type="radio" id="star1" name="rating" value="1" />
                                <label for="star1"></label>
                              </div>
                              <div class="col-md-12">
                                <div class="form-group">
                                  <textarea class="form-control" name="message" rows="1" placeholder="Review"></textarea>
                                </div>
                              </div>
                              <div class="col-md-12 text-right">
                                <button type="submit" value="submit"  class="btn_3">
                                    Submit Now
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

  <!--================End Product Description Area =================-->

  <!-- product_list part start-->
  <section class="product_list best_seller">
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-lg-12">
          <div class="section_tittle text-center">
            <h2>Best Sellers <span>shop</span></h2>
          </div>
        </div>
      </div>
      <div class="row align-items-center justify-content-between">
        <div class="col-lg-12">
          <div class="best_product_slider owl-carousel">
            {% if product %}
              <div class="single_product_item">
                <a href="../products_details/{{product.id}}"><img src="{{product.images.allast.image.url}}" alt="" /></a>
                  <div class="single_product_text">
                    <h4>{{product.product.products_name}}</h4>
                  <h3>${{product.price}}</h3>
                </div>
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </section>
  <!-- product_list part end-->
  <script src="{% static "assets_products/js/theme.js" %}"></script>
  <script src="{% static "assets_products/js/swiper.jquery.js" %}"></script>
  <!-- Add this to the head section of your HTML -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
  {% block script %}
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
  <!-- Your other scripts go here -->
  {% endblock %}
  
  <script>
  $(document).ready(function () {
    $('#addcart').click(function (e) {
        e.preventDefault();
        console.log('clicked');
        var product_id = $(this).closest('.product_data').find('.prod_id').val();
        var token = $('input[name=csrfmiddlewaretoken]').val();
        console.log('clicked');

        $.ajax({
            method: "POST",
            url: "/addcart/",
            data: {
                'product_id': product_id,
                csrfmiddlewaretoken: token
            },
            dataType: 'json',
            success: function (response) {
                console.log(response);

                if (response.success) {
                    Swal.fire({
                        title: 'Item Added to Cart',
                        text: 'Your item has been added to the cart.',
                        icon: 'success',
                    });
                    $('#cart-count-badge').text(response.cart_count);
                } else {
                    Swal.fire({
                        title: 'Error',
                        text: 'Already in cart',
                        icon: 'error',
                    });
                }
            },
            error: function (xhr, status, error) {
                console.log("Error:", error);
            }
        });
    });
});

function submitForm() {
  let idValue = $('#ItemId').val();  // Corrected variable name
  review_check(idValue);
  return false;
}
</script>  
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Optional for visual feedback on click:
    const starRating = document.querySelector('.rating');
    starRating.addEventListener('click', (event) => {
      const clickedStar = event.target;
      if (clickedStar.tagName === 'LABEL') {
        const input = clickedStar.previousElementSibling;
        if (input) {
          input.checked = !input.checked; // Toggle the checked state
        }
      }
    });
  });
</script>

<script>
  function review_check(id) {
    const num = $("input[name='rating']:checked").val();
    const text = $("textarea[name='message']").val();

    // Validate that a rating is selected
    if (!num) {
      Swal.fire({
        title: 'Validation Error',
        text: 'Please select a rating.',
        icon: 'error',
        confirmButtonColor: '#3085d6',
        confirmButtonText: 'OK'
      });
      return;  // Stop further execution if validation fails
    }

    $.ajax({
      url: `/review_check/${id}/`,
      type: 'POST',
      data: {
        "message": text,
        "rating": num
      },
      headers: {
        'X-CSRFToken': '{{ csrf_token }}',
      },

      success: function (data) {
        if (data.success) {
          // Review already submitted
          Swal.fire({
            title: 'Review Already Submitted',
            text: data.message,
            icon: 'info',
            confirmButtonColor: '#3085d6',
            confirmButtonText: 'OK'
          });
        } else {
          // Review submitted successfully
          Swal.fire({
            title: 'Success!',
            text: data.message,
            icon: 'success',
            confirmButtonColor: '#3085d6',
            confirmButtonText: 'OK'
          }).then((result) => {
            // Reload the page after successful review submission
            location.reload();
          });
        }
      },
      error: function (error) {
        console.error(error);
        console.log('CSRF Token:', '{{ csrf_token }}');
        console.log('Message:', '{{ message }}');
      }
    });
  };
</script>


<script>
  document.addEventListener('DOMContentLoaded', function () {
      const mainImage = document.querySelector('.main-image');
      const zoomImages = document.querySelectorAll('.zoom-image');

      zoomImages.forEach((img, index) => {
          const zoomIn = (event) => {
              const boundingRect = mainImage.getBoundingClientRect();
              const mouseX = event.clientX - boundingRect.left;
              const mouseY = event.clientY - boundingRect.top;

              const offsetX = (mouseX / boundingRect.width) * 100;
              const offsetY = (mouseY / boundingRect.height) * 100;

              img.style.transformOrigin = `${offsetX}% ${offsetY}%`;
              img.style.transform = 'scale(2)'; // Adjust the scale factor as desired
          };

          const zoomOut = () => {
              img.style.transform = 'scale(1)';
          };

          mainImage.addEventListener('mousemove', zoomIn);
          mainImage.addEventListener('mouseleave', zoomOut);
      });
  });
</script>


{% endblock %}
